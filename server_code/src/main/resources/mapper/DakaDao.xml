<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cl.dao.DakaDao">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.cl.entity.DakaEntity">
        <id column="id" property="id" />
        <result column="user_id" property="userId" />
        <result column="user_type" property="userType" />
        <result column="status" property="status" />
        <result column="start_time" property="startTime" />
        <result column="end_time" property="endTime" />
        <result column="pause_time" property="pauseTime" />
        <result column="resume_time" property="resumeTime" />
        <result column="total_duration" property="totalDuration" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, user_id, user_type, status, start_time, end_time, pause_time, resume_time, total_duration, create_time, update_time
    </sql>

    <!-- 根据用户ID获取今日打卡记录 -->
    <select id="getTodayDakaByUserId" resultMap="BaseResultMap">
        SELECT * FROM daka
        WHERE user_id = #{userId}
        AND DATE(create_time) = CURDATE()
        ORDER BY create_time DESC
        LIMIT 1
    </select>

    <!-- 获取用户打卡统计 -->
    <select id="getDakaStatistics" resultType="java.util.Map">
        SELECT 
            DATE(create_time) as date,
            COUNT(*) as count,
            AVG(total_duration) as avg_duration
        FROM daka
        WHERE user_id = #{userId}
        GROUP BY DATE(create_time)
        ORDER BY date DESC
    </select>

    <!-- 获取用户打卡记录 -->
    <select id="getDakaRecords" resultMap="BaseResultMap">
        SELECT * FROM daka
        WHERE user_id = #{userId}
        ORDER BY create_time DESC
        LIMIT 10
    </select>

</mapper>